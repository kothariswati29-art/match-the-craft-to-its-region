<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Casa Carigar - Match the Craft</title>
<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;500;600&family=Urbanist:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-1: #f8f4ea;
  --bg-2: #efe7d8;
  --panel: #fcf9f2;
  --ink: #14373f;
  --ink-soft: #5a757a;
  --accent: #8d391e;
  --accent-strong: #7a2f19;
  --soft-fill: rgba(20, 55, 63, 0.08);
  --good-bg: #e9f6ed;
  --good-border: #5ca777;
  --bad-bg: #fbecec;
  --bad-border: #d16a6a;
  --radius-lg: 18px;
  --radius-md: 14px;
  --shadow: 0 16px 36px rgba(20, 55, 63, 0.1);
}

* {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  min-height: 100%;
}

body {
  font-family: "Urbanist", sans-serif;
  color: var(--ink);
  background: linear-gradient(165deg, var(--bg-1) 0%, var(--bg-2) 100%);
}

.app-shell {
  min-height: 100vh;
  width: 100%;
  padding: 16px;
}

.view {
  width: min(100%, 1040px);
  margin: 0 auto;
  display: none;
}

.view.is-active {
  display: block;
}

.panel {
  background: var(--panel);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow);
  padding: 24px;
}

.home-layout {
  min-height: calc(100vh - 32px);
  display: grid;
  place-items: center;
}

.home-card {
  width: min(100%, 760px);
}

.logo {
  display: block;
  margin: 0 auto 24px;
  width: auto;
  height: auto;
  max-height: 200px;
  max-width: min(100%, 520px);
  object-fit: contain;
}

h1,
h2,
h3 {
  margin: 0;
  font-family: "Spectral", serif;
  font-weight: 600;
}

.title {
  text-align: center;
  font-size: clamp(32px, 4vw, 46px);
  line-height: 1.1;
}

.subtitle {
  margin: 12px 0 0;
  text-align: center;
  color: var(--ink-soft);
  font-size: 16px;
}

.input {
  width: 100%;
  margin-top: 24px;
  border: 0;
  border-radius: var(--radius-md);
  padding: 14px 16px;
  font-size: 15px;
  background: #fff;
  color: var(--ink);
  box-shadow: inset 0 0 0 1px rgba(20, 55, 63, 0.14);
}

.input:focus {
  outline: none;
  box-shadow: inset 0 0 0 2px rgba(20, 55, 63, 0.28);
}

.row {
  display: flex;
  gap: 8px;
  margin-top: 16px;
}

.btn {
  border: 0;
  border-radius: 12px;
  padding: 12px 16px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 150ms ease, background-color 150ms ease, color 150ms ease, box-shadow 150ms ease;
}

.btn:hover:not(:disabled) {
  transform: translateY(-1px);
}

.btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

.btn-primary {
  background: var(--accent);
  color: #fff;
}

.btn-primary:hover:not(:disabled) {
  background: var(--accent-strong);
}

.btn-secondary {
  background: var(--soft-fill);
  color: var(--ink);
}

.btn-secondary:hover:not(:disabled) {
  background: rgba(20, 55, 63, 0.14);
}

.btn-home {
  background: #1e4147;
  color: #f7f1e4;
}

.btn-home:hover:not(:disabled) {
  background: #16353a;
}

.game-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
}

.score-text {
  color: var(--ink-soft);
  font-weight: 600;
}

.game-layout {
  position: relative;
  display: grid;
  grid-template-columns: minmax(260px, 1fr) 140px minmax(260px, 1fr);
  gap: 16px;
  align-items: start;
  width: min(100%, 980px);
  margin: 0 auto;
}

.col-title {
  font-size: 18px;
  color: var(--ink-soft);
  margin-bottom: 12px;
}

.card-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.match-card {
  width: 100%;
  min-height: 50px;
  border: 0;
  border-radius: 14px;
  background: #fff;
  color: var(--ink);
  text-align: left;
  padding: 13px 14px;
  font-size: 14px;
  line-height: 1.25;
  box-shadow: inset 0 0 0 1px rgba(20, 55, 63, 0.1);
  cursor: pointer;
  transition: background-color 150ms ease, box-shadow 150ms ease;
}

.match-card:hover:not(.is-locked) {
  box-shadow: inset 0 0 0 1px rgba(20, 55, 63, 0.26), 0 6px 16px rgba(20, 55, 63, 0.08);
}

.match-card.is-selected {
  background: #fff2ec;
  box-shadow: inset 0 0 0 2px rgba(141, 57, 30, 0.35);
}

.match-card.is-locked {
  cursor: default;
  background: #f4eee2;
}

.spacer {
  position: relative;
  min-height: 100%;
}

.line-svg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.actions {
  margin-top: 24px;
  display: flex;
  justify-content: center;
}

.leaderboard-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
}

.leaderboard-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.leader-row {
  display: grid;
  grid-template-columns: 1fr auto auto;
  gap: 8px;
  align-items: center;
  background: #fff;
  border-radius: 14px;
  padding: 12px;
  box-shadow: inset 0 0 0 1px rgba(20, 55, 63, 0.1);
}

.muted {
  color: var(--ink-soft);
}

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(18, 45, 51, 0.44);
  display: none;
  align-items: center;
  justify-content: center;
  padding: 16px;
  z-index: 1000;
}

.overlay.is-open {
  display: flex;
}

.results-panel {
  width: min(100%, 1040px);
  max-height: min(100vh - 32px, 920px);
  overflow: auto;
}

.results-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}

.result-summary {
  margin: 0 0 16px;
  color: var(--ink-soft);
  font-weight: 600;
}

.results-layout {
  display: grid;
  grid-template-columns: minmax(260px, 1fr) 140px minmax(260px, 1fr);
  gap: 16px;
  align-items: start;
}

.result-card {
  width: 100%;
  min-height: 50px;
  border-radius: 14px;
  background: #fff;
  padding: 13px 14px;
  font-size: 14px;
  line-height: 1.25;
  box-shadow: inset 0 0 0 1px rgba(20, 55, 63, 0.1);
}

.result-card.good {
  background: var(--good-bg);
  box-shadow: inset 0 0 0 1px var(--good-border);
}

.result-card.bad {
  background: var(--bad-bg);
  box-shadow: inset 0 0 0 1px var(--bad-border);
}

@media (max-width: 860px) {
  .app-shell {
    padding: 10px;
  }

  .panel {
    padding: 16px;
    border-radius: 16px;
  }

  .logo {
    max-height: 148px;
    margin-bottom: 18px;
  }

  .row {
    flex-direction: column;
  }

  .row .btn {
    width: 100%;
  }

  .game-layout {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .spacer {
    display: none;
  }

  .card-list {
    gap: 12px;
  }

  .leader-row {
    grid-template-columns: 1fr;
  }

  .results-layout {
    grid-template-columns: 1fr;
    gap: 12px;
  }
}
</style>
</head>
<body>
  <div class="app-shell">
    <section id="home-view" class="view is-active">
      <div class="home-layout">
        <div class="panel home-card">
          <img class="logo" src="./logo.png" alt="Casa Carigar logo" loading="eager" decoding="sync" />
          <h1 class="title">Match the Craft to Its Region</h1>
          <p class="subtitle">Explore India's handcrafted heritage through a refined matching challenge.</p>
          <input id="player-name" class="input" type="text" maxlength="40" placeholder="Your Name" />
          <div class="row">
            <button id="start-btn" class="btn btn-primary" type="button">Start Game</button>
            <button id="leaderboard-btn" class="btn btn-secondary" type="button">Leaderboard</button>
          </div>
        </div>
      </div>
    </section>

    <section id="game-view" class="view">
      <div class="panel">
        <div class="game-head">
          <div id="score-text" class="score-text">Matches: 0 / 10</div>
          <button id="home-from-game-btn" class="btn btn-home" type="button">Home</button>
        </div>

        <div class="game-layout">
          <div>
            <h3 class="col-title">Crafts</h3>
            <div id="craft-list" class="card-list"></div>
          </div>

          <div id="line-spacer" class="spacer">
            <svg id="line-svg" class="line-svg" aria-hidden="true"></svg>
          </div>

          <div>
            <h3 class="col-title">Regions</h3>
            <div id="region-list" class="card-list"></div>
          </div>
        </div>

        <div class="actions">
          <button id="submit-btn" class="btn btn-primary" type="button" disabled>Submit</button>
        </div>
      </div>
    </section>

    <section id="leaderboard-view" class="view">
      <div class="panel">
        <div class="leaderboard-head">
          <h2>Leaderboard</h2>
          <button id="home-from-leaderboard-btn" class="btn btn-home" type="button">Home</button>
        </div>
        <div id="leaderboard-list" class="leaderboard-list"></div>
      </div>
    </section>
  </div>

  <div id="results-overlay" class="overlay" aria-hidden="true">
    <div class="panel results-panel">
      <div class="results-head">
        <h2 id="results-title">Results</h2>
        <button id="results-back-btn" class="btn btn-secondary" type="button">Back to Leaderboard</button>
      </div>
      <p id="results-summary" class="result-summary"></p>
      <div class="results-layout">
        <div>
          <h3 class="col-title">Crafts</h3>
          <div id="results-craft-list" class="card-list"></div>
        </div>
        <div></div>
        <div>
          <h3 class="col-title">Regions</h3>
          <div id="results-region-list" class="card-list"></div>
        </div>
      </div>
    </div>
  </div>

<script>
const CRAFTS = [
  "Brass work", "Wood carving", "Blue pottery", "Block printing",
  "Lacquered toys", "Handmade tiles", "Bidriware",
  "Dhokra metalwork", "Shisha embroidery", "Bone inlay"
];

const REGIONS = [
  "Moradabad", "Saharanpur", "Jaipur", "Sanganer",
  "Channapatna", "Athangudi", "Bidar",
  "Bastar", "Kutch", "Udaipur"
];

const CORRECT_MATCHES = {
  "Brass work": "Moradabad",
  "Wood carving": "Saharanpur",
  "Blue pottery": "Jaipur",
  "Block printing": "Sanganer",
  "Lacquered toys": "Channapatna",
  "Handmade tiles": "Athangudi",
  "Bidriware": "Bidar",
  "Dhokra metalwork": "Bastar",
  "Shisha embroidery": "Kutch",
  "Bone inlay": "Udaipur"
};

const dom = {
  views: {
    home: document.getElementById("home-view"),
    game: document.getElementById("game-view"),
    leaderboard: document.getElementById("leaderboard-view")
  },
  playerName: document.getElementById("player-name"),
  scoreText: document.getElementById("score-text"),
  craftList: document.getElementById("craft-list"),
  regionList: document.getElementById("region-list"),
  lineSvg: document.getElementById("line-svg"),
  lineSpacer: document.getElementById("line-spacer"),
  submitBtn: document.getElementById("submit-btn"),
  leaderboardList: document.getElementById("leaderboard-list"),
  resultsOverlay: document.getElementById("results-overlay"),
  resultsTitle: document.getElementById("results-title"),
  resultsSummary: document.getElementById("results-summary"),
  resultsCraftList: document.getElementById("results-craft-list"),
  resultsRegionList: document.getElementById("results-region-list")
};

const state = {
  currentView: "home",
  currentPlayer: "",
  selectedCraft: null,
  matches: {},
  usedRegions: new Set(),
  shuffledRegions: [],
  craftEls: new Map(),
  regionEls: new Map(),
  lastLeaderboardScrollY: 0,
  resizeRAF: null
};

function isMobile() {
  return window.matchMedia("(max-width: 860px)").matches;
}

function switchView(viewName) {
  Object.values(dom.views).forEach((view) => view.classList.remove("is-active"));
  dom.views[viewName].classList.add("is-active");
  state.currentView = viewName;

  if (viewName !== "game") {
    clearLines();
    state.selectedCraft = null;
    state.craftEls.forEach((el) => el.classList.remove("is-selected"));
  }

  window.scrollTo({ top: 0, behavior: "smooth" });
}

function shuffle(list) {
  const a = [...list];
  for (let i = a.length - 1; i > 0; i -= 1) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function calculateScore(matches) {
  return CRAFTS.reduce((score, craft) => {
    return score + (matches[craft] === CORRECT_MATCHES[craft] ? 1 : 0);
  }, 0);
}

function startGame() {
  const name = dom.playerName.value.trim();
  if (!name) {
    alert("Enter your name to start.");
    return;
  }

  state.currentPlayer = name;
  state.selectedCraft = null;
  state.matches = {};
  state.usedRegions = new Set();
  state.shuffledRegions = shuffle(REGIONS);
  state.craftEls.clear();
  state.regionEls.clear();

  renderGame();
  updateGameScore();
  switchView("game");
  requestAnimationFrame(drawConnections);
}

function handleMatch(craft, region) {
  state.matches[craft] = region;
  state.usedRegions.add(region);
  state.selectedCraft = null;

  const craftCard = state.craftEls.get(craft);
  const regionCard = state.regionEls.get(region);
  if (craftCard) {
    craftCard.classList.remove("is-selected");
    craftCard.classList.add("is-locked");
  }
  if (regionCard) {
    regionCard.classList.add("is-locked");
  }

  updateGameScore();
  drawConnections();
}

function renderGame() {
  dom.craftList.innerHTML = "";
  dom.regionList.innerHTML = "";
  clearLines();

  CRAFTS.forEach((craft) => {
    const card = document.createElement("button");
    card.type = "button";
    card.className = "match-card";
    card.textContent = craft;
    card.addEventListener("click", () => {
      if (state.matches[craft]) {
        return;
      }
      state.selectedCraft = state.selectedCraft === craft ? null : craft;
      state.craftEls.forEach((el, name) => {
        el.classList.toggle("is-selected", state.selectedCraft === name);
      });
    });
    dom.craftList.appendChild(card);
    state.craftEls.set(craft, card);
  });

  state.shuffledRegions.forEach((region) => {
    const card = document.createElement("button");
    card.type = "button";
    card.className = "match-card";
    card.textContent = region;
    card.addEventListener("click", () => {
      if (!state.selectedCraft || state.usedRegions.has(region)) {
        return;
      }
      handleMatch(state.selectedCraft, region);
    });
    dom.regionList.appendChild(card);
    state.regionEls.set(region, card);
  });
}

function updateGameScore() {
  const count = Object.keys(state.matches).length;
  dom.scoreText.textContent = `Matches: ${count} / ${CRAFTS.length}`;
  dom.submitBtn.disabled = count !== CRAFTS.length;
}

function clearLines() {
  dom.lineSvg.innerHTML = "";
}

function drawConnections() {
  clearLines();
  if (state.currentView !== "game" || isMobile()) {
    return;
  }

  const spacerRect = dom.lineSpacer.getBoundingClientRect();
  const width = spacerRect.width;
  const height = spacerRect.height;
  dom.lineSvg.setAttribute("viewBox", `0 0 ${width} ${height}`);

  Object.entries(state.matches).forEach(([craft, region]) => {
    const craftRect = state.craftEls.get(craft)?.getBoundingClientRect();
    const regionRect = state.regionEls.get(region)?.getBoundingClientRect();
    if (!craftRect || !regionRect) {
      return;
    }

    const y1 = craftRect.top + (craftRect.height / 2) - spacerRect.top;
    const y2 = regionRect.top + (regionRect.height / 2) - spacerRect.top;
    const x1 = 8;
    const x2 = Math.max(10, width - 8);
    const cx1 = width * 0.33;
    const cx2 = width * 0.67;

    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", `M ${x1.toFixed(2)} ${y1.toFixed(2)} C ${cx1.toFixed(2)} ${y1.toFixed(2)}, ${cx2.toFixed(2)} ${y2.toFixed(2)}, ${x2.toFixed(2)} ${y2.toFixed(2)}`);
    path.setAttribute("fill", "none");
    path.setAttribute("stroke", "#6b858a");
    path.setAttribute("stroke-width", "1.5");
    path.setAttribute("stroke-linecap", "round");
    path.setAttribute("opacity", "0.9");
    dom.lineSvg.appendChild(path);
  });
}

function saveScore(name, matches) {
  const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  const score = calculateScore(matches);
  leaderboard.push({
    id: `${Date.now()}-${Math.random().toString(16).slice(2)}`,
    name,
    score,
    matches,
    createdAt: Date.now()
  });

  leaderboard.sort((a, b) => {
    if (b.score !== a.score) {
      return b.score - a.score;
    }
    return a.createdAt - b.createdAt;
  });

  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
}

function submitGame() {
  saveScore(state.currentPlayer, { ...state.matches });
  renderLeaderboard();
  switchView("leaderboard");
}

function renderLeaderboard() {
  const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  dom.leaderboardList.innerHTML = "";

  if (!leaderboard.length) {
    const empty = document.createElement("div");
    empty.className = "leader-row muted";
    empty.textContent = "No scores yet.";
    dom.leaderboardList.appendChild(empty);
    return;
  }

  leaderboard.forEach((entry, index) => {
    const row = document.createElement("div");
    row.className = "leader-row";

    const name = document.createElement("div");
    name.textContent = `${index + 1}. ${entry.name}`;

    const score = document.createElement("strong");
    score.textContent = `${entry.score}/${CRAFTS.length}`;

    const view = document.createElement("button");
    view.type = "button";
    view.className = "btn btn-secondary";
    view.textContent = "View Results";
    view.addEventListener("click", () => openResults(entry));

    row.appendChild(name);
    row.appendChild(score);
    row.appendChild(view);
    dom.leaderboardList.appendChild(row);
  });
}

function openResults(entry) {
  state.lastLeaderboardScrollY = window.scrollY;

  const matches = entry.matches || {};
  const score = calculateScore(matches);
  dom.resultsTitle.textContent = `${entry.name}'s Results`;
  dom.resultsSummary.textContent = `You scored ${score} / ${CRAFTS.length}`;

  dom.resultsCraftList.innerHTML = "";
  dom.resultsRegionList.innerHTML = "";

  const selectedRegions = {};
  CRAFTS.forEach((craft) => {
    const selected = matches[craft];
    const isCorrect = selected === CORRECT_MATCHES[craft];

    const craftCard = document.createElement("div");
    craftCard.className = `result-card ${selected ? (isCorrect ? "good" : "bad") : ""}`.trim();
    craftCard.textContent = `${craft} - ${selected || "-"}`;
    dom.resultsCraftList.appendChild(craftCard);

    if (selected) {
      selectedRegions[selected] = isCorrect ? "good" : "bad";
    }
  });

  REGIONS.forEach((region) => {
    const regionCard = document.createElement("div");
    const status = selectedRegions[region] || "";
    regionCard.className = `result-card ${status}`.trim();
    regionCard.textContent = region;
    dom.resultsRegionList.appendChild(regionCard);
  });

  dom.resultsOverlay.classList.add("is-open");
  dom.resultsOverlay.setAttribute("aria-hidden", "false");
}

function closeResults() {
  dom.resultsOverlay.classList.remove("is-open");
  dom.resultsOverlay.setAttribute("aria-hidden", "true");
  switchView("leaderboard");
  window.scrollTo({ top: state.lastLeaderboardScrollY, behavior: "auto" });
}

function goHome() {
  switchView("home");
}

function bindEvents() {
  document.getElementById("start-btn").addEventListener("click", startGame);
  document.getElementById("leaderboard-btn").addEventListener("click", () => {
    renderLeaderboard();
    switchView("leaderboard");
  });
  document.getElementById("home-from-game-btn").addEventListener("click", goHome);
  document.getElementById("home-from-leaderboard-btn").addEventListener("click", goHome);
  dom.submitBtn.addEventListener("click", submitGame);
  document.getElementById("results-back-btn").addEventListener("click", closeResults);

  window.addEventListener("resize", () => {
    if (state.resizeRAF) {
      cancelAnimationFrame(state.resizeRAF);
    }
    state.resizeRAF = requestAnimationFrame(drawConnections);
  });
}

bindEvents();
</script>
</body>
</html>
