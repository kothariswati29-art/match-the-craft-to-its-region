<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Casa Carigar - Match the Craft</title>
<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;500;600&family=Urbanist:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-1: #f8f4eb;
  --bg-2: #efe7d8;
  --panel: #fbf8f1;
  --text: #13343b;
  --text-soft: #567277;
  --accent: #8d391e;
  --accent-2: #a9573f;
  --good-bg: #e7f3ea;
  --good-text: #1e6a36;
  --bad-bg: #fbe8e8;
  --bad-text: #8f2f2f;
  --shadow: 0 14px 36px rgba(19, 52, 59, 0.1);
}

* {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  min-height: 100%;
}

body {
  font-family: "Urbanist", sans-serif;
  color: var(--text);
  background: linear-gradient(165deg, var(--bg-1) 0%, var(--bg-2) 100%);
}

.app {
  min-height: 100vh;
  width: 100%;
  padding: 16px;
  display: grid;
  place-items: center;
}

.screen {
  width: min(100%, 980px);
  background: var(--panel);
  border-radius: 16px;
  box-shadow: var(--shadow);
  padding: 22px;
}

.hidden {
  display: none;
}

.center-screen {
  min-height: calc(100vh - 32px);
  display: grid;
  place-items: center;
}

.home-card {
  width: min(100%, 560px);
  margin: 0 auto;
}

.logo {
  display: block;
  margin: 0 auto 16px;
  width: auto;
  max-width: min(100%, 360px);
  max-height: 150px;
  height: auto;
  object-fit: contain;
}

h1,
h2,
h3 {
  margin: 0;
  font-family: "Spectral", serif;
}

.title {
  text-align: center;
  font-size: clamp(28px, 4vw, 36px);
  line-height: 1.15;
}

.subtitle {
  margin: 10px 0 0;
  text-align: center;
  color: var(--text-soft);
  font-size: 15px;
}

.input {
  width: 100%;
  margin-top: 24px;
  border: 0;
  border-radius: 12px;
  padding: 13px 14px;
  font-size: 15px;
  color: var(--text);
  background: #ffffff;
  box-shadow: inset 0 0 0 1px rgba(19, 52, 59, 0.12);
}

.input:focus {
  outline: none;
  box-shadow: inset 0 0 0 2px rgba(19, 52, 59, 0.28);
}

.actions {
  margin-top: 16px;
  display: flex;
  gap: 10px;
}

.btn {
  border: 0;
  border-radius: 11px;
  padding: 11px 16px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 160ms ease, background-color 160ms ease, color 160ms ease, box-shadow 160ms ease;
}

.btn:hover:not(:disabled) {
  transform: translateY(-1px);
}

.btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

.btn-primary {
  background: var(--accent);
  color: #fff;
}

.btn-primary:hover:not(:disabled) {
  background: #7f3119;
}

.btn-secondary {
  background: rgba(19, 52, 59, 0.1);
  color: var(--text);
}

.btn-secondary:hover:not(:disabled) {
  background: rgba(19, 52, 59, 0.16);
}

.btn-home {
  background: #1f4046;
  color: #f7f0e2;
}

.btn-home:hover:not(:disabled) {
  background: #163238;
}

.game-logo,
.leaderboard-logo {
  margin-bottom: 16px;
}

.game-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  margin-bottom: 14px;
}

.score {
  color: var(--text-soft);
  font-weight: 600;
  font-size: 15px;
}

.board {
  position: relative;
  width: min(100%, 900px);
  margin: 0 auto;
  border-radius: 14px;
  background: #fffdf8;
  box-shadow: inset 0 0 0 1px rgba(19, 52, 59, 0.08);
  padding: 12px;
  overflow: hidden;
}

.pair-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  align-items: start;
}

.col {
  min-width: 0;
}

.col h3 {
  font-size: 16px;
  color: var(--text-soft);
  margin-bottom: 8px;
}

.list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.card {
  width: 100%;
  min-height: 44px;
  padding: 11px 10px;
  text-align: left;
  border: 0;
  border-radius: 10px;
  background: #ffffff;
  color: var(--text);
  box-shadow: inset 0 0 0 1px rgba(19, 52, 59, 0.1);
  cursor: pointer;
  font-size: 14px;
  line-height: 1.25;
  transition: background-color 160ms ease, box-shadow 160ms ease, color 160ms ease;
}

.card:hover:not(.is-locked) {
  box-shadow: inset 0 0 0 1px rgba(19, 52, 59, 0.3), 0 4px 14px rgba(19, 52, 59, 0.08);
}

.card.is-selected {
  background: #fff2ec;
  box-shadow: inset 0 0 0 2px rgba(169, 87, 63, 0.45);
}

.card.is-locked {
  cursor: default;
  background: #f2ece0;
}

.line-layer {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

.game-actions {
  margin-top: 14px;
  display: flex;
  justify-content: center;
}

.leaderboard-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.leaderboard-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.leaderboard-item {
  display: grid;
  grid-template-columns: 1fr auto auto;
  gap: 8px;
  align-items: center;
  background: #fffdf8;
  border-radius: 10px;
  padding: 10px 12px;
  box-shadow: inset 0 0 0 1px rgba(19, 52, 59, 0.08);
}

.muted {
  color: var(--text-soft);
}

.result-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.result-summary {
  margin: 0 0 14px;
  color: var(--text-soft);
  font-weight: 600;
}

.result-board .card {
  cursor: default;
}

.card.good {
  background: var(--good-bg);
  color: var(--good-text);
  box-shadow: inset 0 0 0 1px rgba(30, 106, 54, 0.25);
}

.card.bad {
  background: var(--bad-bg);
  color: var(--bad-text);
  box-shadow: inset 0 0 0 1px rgba(143, 47, 47, 0.25);
}

.result-match-list {
  margin-top: 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.result-match-item {
  font-size: 13px;
  color: var(--text-soft);
}

@media (max-width: 760px) {
  .app {
    padding: 10px;
  }

  .screen {
    padding: 14px;
    border-radius: 14px;
  }

  .logo {
    max-height: 90px;
    max-width: min(100%, 280px);
  }

  .actions {
    flex-direction: column;
  }

  .actions .btn {
    width: 100%;
  }

  .game-top {
    margin-bottom: 10px;
  }

  .pair-grid {
    gap: 6px;
  }

  .card {
    min-height: 42px;
    font-size: 13px;
    padding: 10px 8px;
  }

  .leaderboard-item {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
  <div class="app">
    <section id="homeScreen" class="screen center-screen">
      <div class="home-card">
        <img class="logo" src="./logo.png" alt="Casa Carigar logo" loading="eager" decoding="sync">
        <h1 class="title">Match the Craft to Its Region</h1>
        <p class="subtitle">Discover the geography behind India's handcrafted traditions.</p>
        <input id="playerName" class="input" type="text" maxlength="40" placeholder="Your Name">
        <div class="actions">
          <button id="startBtn" class="btn btn-primary" type="button">Start Game</button>
          <button id="openLeaderboardBtn" class="btn btn-secondary" type="button">Leaderboard</button>
        </div>
      </div>
    </section>

    <section id="gameScreen" class="screen hidden">
      <img class="logo game-logo" src="./logo.png" alt="Casa Carigar logo" loading="eager" decoding="sync">
      <div class="game-top">
        <div id="scoreText" class="score">Matches: 0 / 10</div>
        <button id="homeFromGameBtn" class="btn btn-home" type="button">Home</button>
      </div>
      <div id="gameBoard" class="board">
        <svg id="lineLayer" class="line-layer" aria-hidden="true"></svg>
        <div class="pair-grid">
          <div class="col">
            <h3>Crafts</h3>
            <div id="craftList" class="list"></div>
          </div>
          <div class="col">
            <h3>Regions</h3>
            <div id="regionList" class="list"></div>
          </div>
        </div>
      </div>
      <div class="game-actions">
        <button id="submitBtn" class="btn btn-primary" type="button" disabled>Submit</button>
      </div>
    </section>

    <section id="leaderboardScreen" class="screen hidden">
      <img class="logo leaderboard-logo" src="./logo.png" alt="Casa Carigar logo" loading="eager" decoding="sync">
      <div class="leaderboard-head">
        <h2>Leaderboard</h2>
        <button id="backHomeFromLeaderboardBtn" class="btn btn-home" type="button">Home</button>
      </div>
      <div id="leaderboardList" class="leaderboard-list"></div>
    </section>

    <section id="resultScreen" class="screen hidden">
      <div class="result-head">
        <h2 id="resultTitle">Results</h2>
        <div class="actions" style="margin-top: 0;">
          <button id="homeFromResultBtn" class="btn btn-home" type="button">Home</button>
          <button id="backToLeaderboardBtn" class="btn btn-secondary hidden" type="button">Back to Leaderboard</button>
        </div>
      </div>
      <p id="resultSummary" class="result-summary"></p>
      <div id="resultBoard" class="board result-board"></div>
      <div id="resultMatchList" class="result-match-list"></div>
    </section>
  </div>

<script>
const CRAFTS = [
  "Brass work", "Wood carving", "Blue pottery", "Block printing",
  "Lacquered toys", "Handmade tiles", "Bidriware",
  "Dhokra metalwork", "Shisha embroidery", "Bone inlay"
];

const REGIONS = [
  "Moradabad", "Saharanpur", "Jaipur", "Sanganer",
  "Channapatna", "Athangudi", "Bidar",
  "Bastar", "Kutch", "Udaipur"
];

const CORRECT_MATCHES = {
  "Brass work": "Moradabad",
  "Wood carving": "Saharanpur",
  "Blue pottery": "Jaipur",
  "Block printing": "Sanganer",
  "Lacquered toys": "Channapatna",
  "Handmade tiles": "Athangudi",
  "Bidriware": "Bidar",
  "Dhokra metalwork": "Bastar",
  "Shisha embroidery": "Kutch",
  "Bone inlay": "Udaipur"
};

const SCREENS = {
  home: document.getElementById("homeScreen"),
  game: document.getElementById("gameScreen"),
  leaderboard: document.getElementById("leaderboardScreen"),
  result: document.getElementById("resultScreen")
};

const dom = {
  playerName: document.getElementById("playerName"),
  scoreText: document.getElementById("scoreText"),
  craftList: document.getElementById("craftList"),
  regionList: document.getElementById("regionList"),
  submitBtn: document.getElementById("submitBtn"),
  gameBoard: document.getElementById("gameBoard"),
  lineLayer: document.getElementById("lineLayer"),
  leaderboardList: document.getElementById("leaderboardList"),
  resultTitle: document.getElementById("resultTitle"),
  resultSummary: document.getElementById("resultSummary"),
  resultBoard: document.getElementById("resultBoard"),
  resultMatchList: document.getElementById("resultMatchList"),
  backToLeaderboardBtn: document.getElementById("backToLeaderboardBtn")
};

const state = {
  currentPlayer: "",
  selectedCraft: null,
  matches: {},
  usedRegions: new Set(),
  shuffledRegions: [],
  craftElements: new Map(),
  regionElements: new Map(),
  resizeRAF: null
};

function showScreen(name) {
  Object.values(SCREENS).forEach((screen) => screen.classList.add("hidden"));
  SCREENS[name].classList.remove("hidden");
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i -= 1) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function goHome() {
  clearLines();
  showScreen("home");
}

function startGame() {
  const name = dom.playerName.value.trim();
  if (!name) {
    alert("Enter your name to start.");
    return;
  }

  state.currentPlayer = name;
  state.selectedCraft = null;
  state.matches = {};
  state.usedRegions = new Set();
  state.shuffledRegions = shuffle([...REGIONS]);
  state.craftElements.clear();
  state.regionElements.clear();

  renderGameBoard();
  updateGameScore();
  showScreen("game");
  requestAnimationFrame(drawConnections);
}

function renderGameBoard() {
  dom.craftList.innerHTML = "";
  dom.regionList.innerHTML = "";
  clearLines();

  CRAFTS.forEach((craft) => {
    const card = document.createElement("button");
    card.className = "card";
    card.type = "button";
    card.textContent = craft;
    card.addEventListener("click", () => selectCraft(craft));
    dom.craftList.appendChild(card);
    state.craftElements.set(craft, card);
  });

  state.shuffledRegions.forEach((region) => {
    const card = document.createElement("button");
    card.className = "card";
    card.type = "button";
    card.textContent = region;
    card.addEventListener("click", () => selectRegion(region));
    dom.regionList.appendChild(card);
    state.regionElements.set(region, card);
  });
}

function selectCraft(craft) {
  if (state.matches[craft]) {
    return;
  }

  state.selectedCraft = state.selectedCraft === craft ? null : craft;
  state.craftElements.forEach((element, craftName) => {
    element.classList.toggle("is-selected", state.selectedCraft === craftName);
  });
}

function handleMatch(craft, region) {
  state.matches[craft] = region;
  state.usedRegions.add(region);
  state.selectedCraft = null;

  const craftElement = state.craftElements.get(craft);
  const regionElement = state.regionElements.get(region);

  if (craftElement) {
    craftElement.classList.remove("is-selected");
    craftElement.classList.add("is-locked");
  }

  if (regionElement) {
    regionElement.classList.add("is-locked");
  }

  updateGameScore();
  drawConnections();
}

function selectRegion(region) {
  if (!state.selectedCraft || state.usedRegions.has(region)) {
    return;
  }
  handleMatch(state.selectedCraft, region);
}

function calculateScore(matches) {
  let score = 0;
  CRAFTS.forEach((craft) => {
    if (matches[craft] === CORRECT_MATCHES[craft]) {
      score += 1;
    }
  });
  return score;
}

function updateGameScore() {
  const count = Object.keys(state.matches).length;
  dom.scoreText.textContent = `Matches: ${count} / ${CRAFTS.length}`;
  dom.submitBtn.disabled = count !== CRAFTS.length;
}

function clearLines() {
  dom.lineLayer.innerHTML = "";
}

function drawConnections() {
  clearLines();
  const boardRect = dom.gameBoard.getBoundingClientRect();
  const stroke = getComputedStyle(document.documentElement).getPropertyValue("--text-soft").trim();

  Object.entries(state.matches).forEach(([craft, region]) => {
    const craftElement = state.craftElements.get(craft);
    const regionElement = state.regionElements.get(region);
    if (!craftElement || !regionElement) {
      return;
    }

    const cRect = craftElement.getBoundingClientRect();
    const rRect = regionElement.getBoundingClientRect();

    const x1 = cRect.right - boardRect.left;
    const y1 = cRect.top + (cRect.height / 2) - boardRect.top;
    const x2 = rRect.left - boardRect.left;
    const y2 = rRect.top + (rRect.height / 2) - boardRect.top;
    const dx = Math.max(18, (x2 - x1) * 0.35);

    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", `M ${x1.toFixed(2)} ${y1.toFixed(2)} C ${(x1 + dx).toFixed(2)} ${y1.toFixed(2)}, ${(x2 - dx).toFixed(2)} ${y2.toFixed(2)}, ${x2.toFixed(2)} ${y2.toFixed(2)}`);
    path.setAttribute("fill", "none");
    path.setAttribute("stroke", stroke);
    path.setAttribute("stroke-width", "1.5");
    path.setAttribute("stroke-linecap", "round");
    path.setAttribute("opacity", "0.8");
    dom.lineLayer.appendChild(path);
  });
}

function saveScore(name, score, matches) {
  const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  leaderboard.push({
    id: `${Date.now()}-${Math.random().toString(16).slice(2)}`,
    name,
    score,
    matches,
    createdAt: Date.now()
  });
  leaderboard.sort((a, b) => {
    if (b.score !== a.score) {
      return b.score - a.score;
    }
    return a.createdAt - b.createdAt;
  });
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
}

function submitGame() {
  const score = calculateScore(state.matches);
  saveScore(state.currentPlayer, score, { ...state.matches });
  renderResults({
    title: "Results",
    name: state.currentPlayer,
    matches: { ...state.matches },
    showLeaderboardBack: false
  });
  showScreen("result");
}

function renderLeaderboard() {
  const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  dom.leaderboardList.innerHTML = "";

  if (!leaderboard.length) {
    const empty = document.createElement("div");
    empty.className = "leaderboard-item muted";
    empty.textContent = "No scores yet.";
    dom.leaderboardList.appendChild(empty);
    return;
  }

  leaderboard.forEach((entry, index) => {
    const row = document.createElement("div");
    row.className = "leaderboard-item";

    const nameEl = document.createElement("div");
    nameEl.textContent = `${index + 1}. ${entry.name}`;

    const scoreEl = document.createElement("strong");
    scoreEl.textContent = `${entry.score}/${CRAFTS.length}`;

    const viewBtn = document.createElement("button");
    viewBtn.className = "btn btn-secondary";
    viewBtn.type = "button";
    viewBtn.textContent = "View Results";
    viewBtn.addEventListener("click", () => {
      renderResults({
        title: `${entry.name}'s Results`,
        name: entry.name,
        matches: entry.matches || {},
        showLeaderboardBack: true
      });
      showScreen("result");
    });

    row.appendChild(nameEl);
    row.appendChild(scoreEl);
    row.appendChild(viewBtn);
    dom.leaderboardList.appendChild(row);
  });
}

function renderResults(options) {
  const matches = options.matches || {};
  const score = calculateScore(matches);
  const regionStatus = {};

  CRAFTS.forEach((craft) => {
    const selectedRegion = matches[craft];
    if (!selectedRegion) {
      return;
    }
    regionStatus[selectedRegion] = selectedRegion === CORRECT_MATCHES[craft] ? "good" : "bad";
  });

  dom.resultTitle.textContent = options.title;
  dom.resultSummary.textContent = `${options.name} scored ${score} / ${CRAFTS.length}`;
  dom.backToLeaderboardBtn.classList.toggle("hidden", !options.showLeaderboardBack);

  dom.resultBoard.innerHTML = `
    <div class="pair-grid">
      <div class="col">
        <h3>Crafts</h3>
        <div id="resultCraftList" class="list"></div>
      </div>
      <div class="col">
        <h3>Regions</h3>
        <div id="resultRegionList" class="list"></div>
      </div>
    </div>
  `;

  const resultCraftList = document.getElementById("resultCraftList");
  const resultRegionList = document.getElementById("resultRegionList");

  CRAFTS.forEach((craft) => {
    const selectedRegion = matches[craft] || "-";
    const good = selectedRegion === CORRECT_MATCHES[craft];
    const card = document.createElement("div");
    card.className = `card ${selectedRegion === "-" ? "" : (good ? "good" : "bad")}`.trim();
    card.textContent = `${craft} - ${selectedRegion}`;
    resultCraftList.appendChild(card);
  });

  REGIONS.forEach((region) => {
    const card = document.createElement("div");
    const statusClass = regionStatus[region] || "";
    card.className = `card ${statusClass}`.trim();
    card.textContent = region;
    resultRegionList.appendChild(card);
  });

  dom.resultMatchList.innerHTML = "";
  CRAFTS.forEach((craft) => {
    const selectedRegion = matches[craft] || "-";
    const item = document.createElement("div");
    item.className = "result-match-item";
    item.textContent = `${craft} -> ${selectedRegion}`;
    dom.resultMatchList.appendChild(item);
  });
}

function openLeaderboard() {
  clearLines();
  renderLeaderboard();
  showScreen("leaderboard");
}

function bindEvents() {
  document.getElementById("startBtn").addEventListener("click", startGame);
  document.getElementById("openLeaderboardBtn").addEventListener("click", openLeaderboard);
  document.getElementById("homeFromGameBtn").addEventListener("click", goHome);
  document.getElementById("backHomeFromLeaderboardBtn").addEventListener("click", goHome);
  document.getElementById("homeFromResultBtn").addEventListener("click", goHome);
  document.getElementById("backToLeaderboardBtn").addEventListener("click", openLeaderboard);
  dom.submitBtn.addEventListener("click", submitGame);

  window.addEventListener("resize", () => {
    if (SCREENS.game.classList.contains("hidden")) {
      return;
    }
    if (state.resizeRAF) {
      cancelAnimationFrame(state.resizeRAF);
    }
    state.resizeRAF = requestAnimationFrame(drawConnections);
  });
}

bindEvents();
showScreen("home");
</script>
</body>
</html>
